{
  "name": "Klarpakke: Risk Monitor",
  "flow": [
    {
      "id": 1,
      "module": "gateway:Schedule",
      "version": 1,
      "parameters": {
        "schedule": "*/5 * * * *"
      }
    },
    {
      "id": 2,
      "module": "postgresql:selectRows",
      "version": 1,
      "parameters": {
        "connection": "supabase",
        "schema": "public",
        "table": "daily_risk_meter"
      },
      "mapper": {
        "condition": "date = current_date"
      }
    },
    {
      "id": 3,
      "module": "util:SetVariable",
      "version": 1,
      "mapper": {
        "daily_loss": "{{2.daily_loss}}",
        "weekly_loss": "{{2.weekly_loss}}",
        "daily_limit": "-1000",
        "weekly_limit": "-3000"
      }
    },
    {
      "id": 4,
      "module": "util:Filter",
      "version": 1,
      "filter": {
        "conditions": [
          ["{{3.daily_loss}}", "numeric:less", "{{3.daily_limit}}"],
          ["{{3.weekly_loss}}", "numeric:less", "{{3.weekly_limit}}"]
        ],
        "operator": "or"
      }
    },
    {
      "id": 5,
      "module": "http:ActionSendData",
      "version": 1,
      "parameters": {
        "url": "https://YOUR_WEBHOOK_URL/kill-switch",
        "method": "POST"
      },
      "mapper": {
        "reason": "Risk limit breached: Daily {{3.daily_loss}} / Weekly {{3.weekly_loss}}"
      }
    }
  ]
}
