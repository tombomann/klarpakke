name: Webflow deploy (footer loader)

on:
  push:
    branches: [main]
    paths:
      - 'web/**'
      - 'scripts/webflow-set-footer-loader.sh'
      - 'web/snippets/webflow-footer-loader.template.html'
      - '.github/workflows/webflow-deploy.yml'
  workflow_dispatch:

jobs:
  deploy-staging:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install jq
        run: |
          sudo apt-get update
          sudo apt-get install -y jq

      - name: Deploy footer loader + publish
        env:
          WEBFLOW_API_TOKEN: ${{ secrets.WEBFLOW_API_TOKEN }}
          WEBFLOW_SITE_ID: ${{ secrets.WEBFLOW_SITE_ID }}
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
          # Optional overrides
          KLARPAKKE_ASSET_BASE: ${{ secrets.KLARPAKKE_ASSET_BASE }}
          KLARPAKKE_DEBUG: ${{ secrets.KLARPAKKE_DEBUG }}
          # Publishes to webflow.io by default; override with JSON array string
          WEBFLOW_PUBLISH_DOMAINS: ${{ secrets.WEBFLOW_PUBLISH_DOMAINS }}
        run: |
          bash scripts/webflow-set-footer-loader.sh
