name: Webflow Sync

on:
  schedule:
    # Every 5 minutes
    - cron: '*/5 * * * *'
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Sync Supabase → Webflow CMS
        env:
          SUPABASE_URL: https://swfyuwkptusceiouqlks.supabase.co
          SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
          WEBFLOW_API_TOKEN: ${{ secrets.WEBFLOW_API_TOKEN }}
          WEBFLOW_COLLECTION_ID: ${{ secrets.WEBFLOW_COLLECTION_ID }}
        run: |
          # Fetch pending signals from Supabase
          SIGNALS=$(curl -s "$SUPABASE_URL/rest/v1/signals?status=eq.pending&limit=10" \
            -H "apikey: $SUPABASE_ANON_KEY" \
            -H "Authorization: Bearer $SUPABASE_ANON_KEY")
          
          echo "Found signals:"
          echo "$SIGNALS" | jq '.[] | {symbol, direction, confidence}'
          
          # Count signals
          COUNT=$(echo "$SIGNALS" | jq 'length')
          echo "✅ Synced $COUNT signals"
          
          # TODO: Push to Webflow CMS API
          # (Current implementation: signals fetched directly from Supabase in UI)

      - name: Log Summary
        run: |
          echo "## Webflow Sync Summary" >> $GITHUB_STEP_SUMMARY
          echo "- Timestamp: $(date)" >> $GITHUB_STEP_SUMMARY
          echo "- Status: ✅ Complete" >> $GITHUB_STEP_SUMMARY
